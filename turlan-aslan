<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Дифференциалдық модельдер — Финалдық версия</title>

  <!-- Chart.js and MathJax (only once each) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['\( ', ' \)'], ['\\(', '\\)']],
        displayMath: [['\[ ', ' \]'], ['\\[', '\\]']]
      }
    };
  </script>

  <style>
    /* Unified styling with white background */
    body {
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: white;
      min-height: 100%;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .header {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }
    .header h1 { font-size: 2rem; margin: 0 0 6px; text-shadow: 1px 1px 3px rgba(0,0,0,0.1); }
    .header p { margin: 0 0 14px; opacity: .95; }

    .tabs {
      display: flex;
      flex-wrap: wrap;
      background: #f8f9fa;
      border-radius: 12px 12px 0 0;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    .tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.25s ease;
      border: none;
      background: #e9ecef;
      font-size: 1rem;
      font-weight: 600;
    }
    .tab.active {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }
    .tab:hover:not(.active) { background: #dee2e6; }

    .content {
      background: white;
      border-radius: 0 0 12px 12px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }

    .formula-section { display: none; }
    .formula-section.active { display: block; }

    .formula-card {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 18px;
      margin-bottom: 16px;
      border-left: 5px solid #667eea;
    }
    .formula-title { font-size: 1.2rem; font-weight: 700; color: #667eea; margin-bottom: 8px; }
    .formula-pair {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .controls { display: flex; gap: 12px; align-items: center; margin: 12px 0; flex-wrap: wrap; }
    .control-group { display: flex; align-items: center; gap: 8px; }
    .control-group label { font-weight: 600; color: #495057; }
    .control-group input { padding: 8px 10px; border: 2px solid #e9ecef; border-radius: 6px; width: 90px; }

    .btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    .chart-container {
      background: white;
      border-radius: 10px;
      padding: 12px;
      margin-top: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.06);
    }

    @media (max-width: 820px) {
      .tabs { flex-direction: column; }
      .controls { flex-direction: column; align-items: stretch; }
      .control-group input { width: 100%; }
      .formula-pair { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>Дифференциалдық модельдер</h1>
    </div>

    <div class="tabs" role="tablist" aria-label="Models tabs">
      <button class="tab active" onclick="showTab('physics')">Гармоникалық тербеліс</button>
      <button class="tab" onclick="showTab('seismograph')">Сейсмограф моделі</button>
      <button class="tab" onclick="showTab('magnitude')">Магнитуда формуласы</button>
      <button class="tab" onclick="showTab('biology')">Популяция</button>
      <button class="tab" onclick="showTab('geography')">Үздіксіз пайыздар</button>
      <button class="tab" onclick="showTab('chemistry')">Екінші ретті реакция</button>
      <button class="tab" onclick="showTab('temperature')">Температура</button>
      <button class="tab" onclick="showTab('pollution')">Ластану</button>
    </div>

    <div class="content">
      <!-- PHYSICS (Harmonic from original seismograph) -->
      <section id="physics" class="formula-section active" aria-labelledby="Физика">
        <div class="formula-card">
          <div class="formula-title">Гармоникалық тербеліс</div>
          <div class="formula-pair">
            <p>Дифференциалдық теңдеу: \[ \frac{d^2x}{dt^2} + \omega^2 x = 0 \]</p>
            <p>Қарапайым формула (аналитикалық шешім): \[ x(t) = A \sin(2\pi f t) \]</p>
          </div>
        </div>
        <div class="controls">
          <div class="control-group"><label for="h-amplitude">Амплитуда A (м):</label><input id="h-amplitude" type="number" value="1" step="0.1"></div>
          <div class="control-group"><label for="h-frequency">Жиілік f (Гц):</label><input id="h-frequency" type="number" value="1" step="0.1"></div>
          <div class="control-group"><label for="h-tmax">Уақыт t_max (с):</label><input id="h-tmax" type="number" value="10" step="1"></div>
          <button class="btn" onclick="updatePhysics()">Графикті жаңарту</button>
        </div>
        <div class="chart-container"><canvas id="physicsChart"></canvas></div>
      </section>

      <!-- SEISMOGRAPH (Integrated from seismograph code) -->
      <section id="seismograph" class="formula-section" aria-labelledby="Сейсмограф">
        <div class="formula-card">
          <div class="formula-title">Сейсмограф моделі</div>
          <div class="formula-pair">
            <p>Дифференциалдық теңдеу: \[ m \frac{d^2x}{dt^2} + c \frac{dx}{dt} + k x = -m \frac{d^2y}{dt^2} \]</p>
            <p>Қарапайым формула (жуықтау): x(t) ≈ y(t) for low frequencies (but numerical here)</p>
          </div>
        </div>
        <div class="controls">
          <div class="control-group"><label for="s-mass">Масса m (кг):</label><input id="s-mass" type="number" value="10" step="1"></div>
          <div class="control-group"><label for="s-stiffness">Қатаңдық k (Н/м):</label><input id="s-stiffness" type="number" value="10000" step="100"></div>
          <div class="control-group"><label for="s-damping">Демпфирлеу c (Н·с/м):</label><input id="s-damping" type="number" value="200" step="10"></div>
          <div class="control-group"><label for="s-impulse-amp">Импульс амплитудасы A (м/с²):</label><input id="s-impulse-amp" type="number" value="0.1" step="0.01"></div>
          <div class="control-group"><label for="s-impulse-freq">Импульс жиілігі f (Гц):</label><input id="s-impulse-freq" type="number" value="1" step="0.1"></div>
          <div class="control-group"><label for="s-decay">Сөну коэффициенті α (1/с):</label><input id="s-decay" type="number" value="0.8" step="0.1"></div>
          <div class="control-group"><label for="s-tmax">Уақыт t_max (с):</label><input id="s-tmax" type="number" value="20" step="1"></div>
          <div class="control-group"><label for="s-dt">Қадам Δt (с):</label><input id="s-dt" type="number" value="0.005" step="0.001"></div>
          <button class="btn" onclick="updateSeismograph()">Графикті жаңарту</button>
        </div>
        <div class="chart-container"><canvas id="seismographChart"></canvas></div>
      </section>

      <!-- MAGNITUDE (Integrated from seismograph code) -->
      <section id="magnitude" class="formula-section" aria-labelledby="Магнитуда">
        <div class="formula-card">
          <div class="formula-title">Магнитуда формуласы</div>
          <div class="formula-pair">
            <p>Дифференциалдық теңдеу: (Synthetic based on empirical)</p>
            <p>Қарапайым формула: \[ M = \log_{10}(A) + 3.0 + 1.66 \log_{10}(d) \]</p>
          </div>
        </div>
        <div class="controls">
          <div class="control-group"><label for="m-magnitude">Магнитуда M:</label><input id="m-magnitude" type="number" value="5" step="0.1"></div>
          <div class="control-group"><label for="m-distance">Қашықтық d (км):</label><input id="m-distance" type="number" value="100" step="1"></div>
          <div class="control-group"><label for="m-depth">Тереңдік h (км):</label><input id="m-depth" type="number" value="10" step="1"></div>
          <div class="control-group"><label for="m-tmax">Уақыт t_max (с):</label><input id="m-tmax" type="number" value="15" step="1"></div>
          <button class="btn" onclick="updateMagnitude()">Графикті жаңарту</button>
        </div>
        <div class="chart-container"><canvas id="magnitudeChart"></canvas></div>
      </section>

      <!-- BIOLOGY -->
      <section id="biology" class="formula-section" aria-labelledby="Биология">
        <div class="formula-card">
          <div class="formula-title">Популяцияның логистикалық өсуі</div>
          <div class="formula-pair">
            <p>Дифференциалдық: \[ \frac{dN}{dt} = r N \left(1 - \frac{N}{K}\right) \]</p>
            <p>Қарапайым формула: \[ N(t) = \frac{K N_0 e^{r t}}{K + N_0 (e^{r t} - 1)} \]</p>
          </div>
        </div>
        <div class="controls">
          <div class="control-group"><label for="r-bio">r:</label><input id="r-bio" type="number" value="0.1" step="0.01"></div>
          <div class="control-group"><label for="K-bio">K:</label><input id="K-bio" type="number" value="1000" step="50"></div>
          <div class="control-group"><label for="N0-bio">N₀:</label><input id="N0-bio" type="number" value="100" step="10"></div>
          <div class="control-group"><label for="dt-bio">Δt (сандық):</label><input id="dt-bio" type="number" value="0.1" step="0.01"></div>
          <button class="btn" onclick="updateBiology()">Графикті жаңарту</button>
        </div>
        <div class="chart-container"><canvas id="biologyChart"></canvas></div>
      </section>

      <!-- GEOGRAPHY -->
      <section id="geography" class="formula-section" aria-labelledby="География">
        <div class="formula-card">
          <div class="formula-title">Үздіксіз пайыздық модель</div>
          <div class="formula-pair">
            <p>Дифференциалдық: \[ \frac{dP}{dt} = r P \]</p>
            <p>Қарапайым формула: \[ P(t) = P_0 e^{r t} \]</p>
          </div>
        </div>
        <div class="controls">
          <div class="control-group"><label for="P0-econ">P₀:</label><input id="P0-econ" type="number" value="10000" step="1000"></div>
          <div class="control-group"><label for="r-econ">r %:</label><input id="r-econ" type="number" value="5" step="0.5"></div>
          <div class="control-group"><label for="years-econ">Жыл:</label><input id="years-econ" type="number" value="10" step="1"></div>
          <div class="control-group"><label for="dt-geo">Δt (сандық):</label><input id="dt-geo" type="number" value="0.1" step="0.01"></div>
          <button class="btn" onclick="updateGeography()">Графикті жаңарту</button>
        </div>
        <div class="chart-container"><canvas id="geoChart"></canvas></div>
      </section>

      <!-- CHEMISTRY -->
      <section id="chemistry" class="formula-section" aria-labelledby="Химия">
        <div class="formula-card">
          <div class="formula-title">Екінші ретті реакция кинетикасы</div>
          <div class="formula-pair">
            <p>Дифференциалдық: \[ -\frac{d[A]}{dt} = 2k[A]^2 \]</p>
            <p>Қарапайым формула: \[ [A](t) = \frac{1}{2 k t + \frac{1}{[A]_0}} \]</p>
          </div>
        </div>
        <div class="controls">
          <div class="control-group"><label for="k-chem">k:</label><input id="k-chem" type="number" value="0.1" step="0.01"></div>
          <div class="control-group"><label for="A0-chem">[A]₀:</label><input id="A0-chem" type="number" value="0.1" step="0.01"></div>
          <div class="control-group"><label for="dt-chem">Δt (сандық):</label><input id="dt-chem" type="number" value="0.1" step="0.01"></div>
          <button class="btn" onclick="updateChemistry()">Графикті жаңарту</button>
        </div>
        <div class="chart-container"><canvas id="chemChart"></canvas></div>
      </section>

      <!-- TEMPERATURE -->
      <section id="temperature" class="formula-section" aria-labelledby="Температура">
        <div class="formula-card">
          <div class="formula-title">Температураның таралу теңдеуі</div>
          <div class="formula-pair">
            <p>Дифференциалдық теңдеу: \[ \frac{\partial T}{\partial t} = \alpha \frac{\partial^2 T}{\partial x^2} \]</p>
            <p>Қарапайым формула: \[ T(x,t) = T_b + \frac{A}{\sqrt{4\pi \alpha t}} \exp\left(-\frac{(x - x_0)^2}{4\alpha t}\right) \]</p>
          </div>
        </div>
        <div class="controls">
          <div class="control-group"><label for="alpha">α:</label><input id="alpha" type="number" value="0.01" step="0.001"></div>
          <div class="control-group"><label for="dx-temp">Δx:</label><input id="dx-temp" type="number" value="0.1" step="0.01"></div>
          <div class="control-group"><label for="dt-temp">Δt:</label><input id="dt-temp" type="number" value="0.01" step="0.001"></div>
          <button class="btn" onclick="updateTemperature()">Графикті жаңарту</button>
        </div>
        <div class="chart-container"><canvas id="tempChart"></canvas></div>
      </section>

      <!-- POLLUTION -->
      <section id="pollution" class="formula-section" aria-labelledby="Ластану">
        <div class="formula-card">
          <div class="formula-title">Ластану концентрациясының таралу теңдеуі</div>
          <div class="formula-pair">
            <p>Дифференциалдық теңдеу: \[ \frac{\partial C}{\partial t} = D \frac{\partial^2 C}{\partial x^2} - v\frac{\partial C}{\partial x} + S(x,t) \]</p>
            <p>Қарапайым формула: \[ C(x,t) = \frac{A}{\sqrt{4\pi D t}} \exp\left(-\frac{(x - x_0 - v t)^2}{4 D t}\right) \]</p>
          </div>
        </div>
        <div class="controls">
          <div class="control-group"><label for="D">D:</label><input id="D" type="number" value="0.01" step="0.001"></div>
          <div class="control-group"><label for="v">v:</label><input id="v" type="number" value="0.1" step="0.01"></div>
          <div class="control-group"><label for="dx-poll">Δx:</label><input id="dx-poll" type="number" value="0.1" step="0.01"></div>
          <div class="control-group"><label for="dt-poll">Δt:</label><input id="dt-poll" type="number" value="0.01" step="0.001"></div>
          <button class="btn" onclick="updatePollution()">Графикті жаңарту</button>
        </div>
        <div class="chart-container"><canvas id="pollutionChart"></canvas></div>
      </section>
    </div>
  </div>

  <script>
    // showTab: switch visible section and update charts if needed
    function showTab(id) {
      document.querySelectorAll('.formula-section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelector('.tab[onclick*="' + id + '"]').classList.add('active');
      document.getElementById(id).classList.add('active');

      // After switching, request chart update for that section
      switch (id) {
        case 'physics': updatePhysics(); break;
        case 'seismograph': updateSeismograph(); break;
        case 'magnitude': updateMagnitude(); break;
        case 'biology': updateBiology(); break;
        case 'geography': updateGeography(); break;
        case 'chemistry': updateChemistry(); break;
        case 'temperature': updateTemperature(); break;
        case 'pollution': updatePollution(); break;
      }
    }

    // Shared charts object
    const charts = {};

    // Runge-Kutta 4th order (from seismograph code)
    function rungeKutta4(m, c, k, groundAccel, dt, tMax) {
      const n = Math.floor(tMax / dt);
      const t = [];
      const x = [];
      const groundDisp = [];
      let state = [0, 0]; // [position, velocity]

      function derivatives(state, ti) {
        const [pos, vel] = state;
        const aGround = groundAccel(ti);
        const accel = (-c * vel - k * pos - m * aGround) / m;
        return [vel, accel];
      }

      for (let i = 0; i <= n; i++) {
        const ti = i * dt;
        t.push(ti);
        x.push(state[0]);
        groundDisp.push(groundAccel(ti) / 100); // Scale

        const k1 = derivatives(state, ti);
        const k2 = derivatives([state[0] + dt/2 * k1[0], state[1] + dt/2 * k1[1]], ti + dt/2);
        const k3 = derivatives([state[0] + dt/2 * k2[0], state[1] + dt/2 * k2[1]], ti + dt/2);
        const k4 = derivatives([state[0] + dt * k3[0], state[1] + dt * k3[1]], ti + dt);

        state = [
          state[0] + dt/6 * (k1[0] + 2*k2[0] + 2*k3[0] + k4[0]),
          state[1] + dt/6 * (k1[1] + 2*k2[1] + 2*k3[1] + k4[1])
        ];
      }

      return { t, x, groundDisp };
    }

    /* ---------------- PHYSICS (Harmonic) ---------------- */
    function updatePhysics() {
      const A = parseFloat(document.getElementById('h-amplitude').value);
      const f = parseFloat(document.getElementById('h-frequency').value);
      const tMax = parseFloat(document.getElementById('h-tmax').value);
      const dt = 0.01;

      const timePoints = [];
      const analyticalX = [];

      for (let t = 0; t <= tMax + 1e-9; t += dt) {
        timePoints.push(t.toFixed(2));
        analyticalX.push(A * Math.sin(2 * Math.PI * f * t));
      }

      if (charts.physics) charts.physics.destroy();

      const ctx = document.getElementById('physicsChart').getContext('2d');
      charts.physics = new Chart(ctx, {
        type: 'line',
        data: {
          labels: timePoints,
          datasets: [
            { label: 'x(t) = A·sin(2πft)', data: analyticalX, borderWidth: 2, borderColor: 'blue' }
          ]
        },
        options: {
          responsive: true,
          plugins: { title: { display: true, text: 'Гармоникалық тербеліс' } },
          scales: {
            x: { title: { display: true, text: 'Уақыт (с)' } },
            y: { title: { display: true, text: 'Орны (м)' } }
          }
        }
      });
    }

    /* ---------------- SEISMOGRAPH ---------------- */
    function updateSeismograph() {
      const m = parseFloat(document.getElementById('s-mass').value);
      const k = parseFloat(document.getElementById('s-stiffness').value);
      const c = parseFloat(document.getElementById('s-damping').value);
      const Ag = parseFloat(document.getElementById('s-impulse-amp').value);
      const fg = parseFloat(document.getElementById('s-impulse-freq').value);
      const alpha = parseFloat(document.getElementById('s-decay').value);
      const tMax = parseFloat(document.getElementById('s-tmax').value);
      const dt = parseFloat(document.getElementById('s-dt').value);

      const groundAccel = (ti) => Ag * Math.exp(-alpha * ti) * Math.sin(2 * Math.PI * fg * ti);

      const result = rungeKutta4(m, c, k, groundAccel, dt, tMax);

      const step = Math.max(1, Math.floor(result.t.length / 2000));
      const timePoints = [];
      const groundData = [];
      const seismoData = [];

      for (let i = 0; i < result.t.length; i += step) {
        timePoints.push(result.t[i].toFixed(2));
        groundData.push(result.groundDisp[i] * 1000);
        seismoData.push(result.x[i] * 1000);
      }

      if (charts.seismograph) charts.seismograph.destroy();

      const ctx = document.getElementById('seismographChart').getContext('2d');
      charts.seismograph = new Chart(ctx, {
        type: 'line',
        data: {
          labels: timePoints,
          datasets: [
            { label: 'y(t) — жер қозғалысы', data: groundData, borderWidth: 2, borderColor: 'blue' },
            { label: 'x(t) — сейсмограф жазбасы', data: seismoData, borderWidth: 2, borderColor: 'red', borderDash: [5, 5] }
          ]
        },
        options: {
          responsive: true,
          plugins: { title: { display: true, text: 'Сейсмограф моделі' } },
          scales: {
            x: { title: { display: true, text: 'Уақыт (с)' } },
            y: { title: { display: true, text: 'Ауытқу (мм)' } }
          }
        }
      });
    }

    /* ---------------- MAGNITUDE ---------------- */
    function updateMagnitude() {
      const M = parseFloat(document.getElementById('m-magnitude').value);
      const d = parseFloat(document.getElementById('m-distance').value);
      const tMax = parseFloat(document.getElementById('m-tmax').value);

      const logA = M - 3.0 - 1.66 * Math.log10(d);
      const Amax = Math.pow(10, logA);
      const dt = 0.02;

      const timePoints = [];
      const signalData = [];

      for (let t = 0; t <= tMax + 1e-9; t += dt) {
        timePoints.push(t.toFixed(2));
        const signal = Amax * Math.exp(-0.3 * t) * Math.sin(2 * Math.PI * 1.5 * t);
        signalData.push(signal * 1000);
      }

      if (charts.magnitude) charts.magnitude.destroy();

      const ctx = document.getElementById('magnitudeChart').getContext('2d');
      charts.magnitude = new Chart(ctx, {
        type: 'line',
        data: {
          labels: timePoints,
          datasets: [
            { label: `A(t) = ${Amax.toExponential(2)}·e^(-0.3t)·sin(2π·1.5t)`, data: signalData, borderWidth: 2, borderColor: 'blue' }
          ]
        },
        options: {
          responsive: true,
          plugins: { title: { display: true, text: 'Магнитуда формуласы' } },
          scales: {
            x: { title: { display: true, text: 'Уақыт (с)' } },
            y: { title: { display: true, text: 'Ауытқу (мм)' } }
          }
        }
      });
    }

    /* ---------------- BIOLOGY ---------------- */
    function updateBiology() {
      const r = parseFloat(document.getElementById('r-bio').value);
      const K = parseFloat(document.getElementById('K-bio').value);
      const N0 = parseFloat(document.getElementById('N0-bio').value);
      const dt = parseFloat(document.getElementById('dt-bio').value);

      const tMax = 50;
      const timePoints = [];
      const analyticalN = [];
      const numericalN = [];
      let N = N0;

      for (let t = 0; t <= tMax + 1e-9; t += dt) {
        timePoints.push(t.toFixed(1));
        const expTerm = Math.exp(r * t);
        analyticalN.push((K * N0 * expTerm) / (K + N0 * (expTerm - 1)));

        const dN = r * N * (1 - N / K);
        N += dN * dt;
        numericalN.push(N);
      }

      if (charts.biology) charts.biology.destroy();

      const ctx = document.getElementById('biologyChart').getContext('2d');
      charts.biology = new Chart(ctx, {
        type: 'line',
        data: {
          labels: timePoints,
          datasets: [
            { label: 'Аналитикалық (қарапайым формула)', data: analyticalN, borderWidth: 2, borderColor: 'blue' },
            { label: 'Сандық (дифференциалдық)', data: numericalN, borderWidth: 2, borderColor: 'red', borderDash: [5, 5] }
          ]
        },
        options: {
          responsive: true,
          plugins: { title: { display: true, text: 'Популяцияның логистикалық өсімі' } },
          scales: {
            x: { title: { display: true, text: 'Уақыт' } },
            y: { title: { display: true, text: 'Популяция' } }
          }
        }
      });
    }

    /* ---------------- GEOGRAPHY ---------------- */
    function updateGeography() {
      const P0 = parseFloat(document.getElementById('P0-econ').value);
      const rPercent = parseFloat(document.getElementById('r-econ').value);
      const years = parseFloat(document.getElementById('years-econ').value);
      const dt = parseFloat(document.getElementById('dt-geo').value);

      const r = rPercent / 100;
      const timePoints = [];
      const analyticalP = [];
      const numericalP = [];
      let P = P0;

      for (let t = 0; t <= years + 1e-9; t += dt) {
        timePoints.push(t.toFixed(1));
        analyticalP.push(P0 * Math.exp(r * t));

        const dP = r * P;
        P += dP * dt;
        numericalP.push(P);
      }

      if (charts.geo) charts.geo.destroy();
      const ctx = document.getElementById('geoChart').getContext('2d');
      charts.geo = new Chart(ctx, {
        type: 'line',
        data: {
          labels: timePoints,
          datasets: [
            { label: 'Аналитикалық (қарапайым формула)', data: analyticalP, borderWidth: 2, borderColor: 'blue' },
            { label: 'Сандық (дифференциалдық)', data: numericalP, borderWidth: 2, borderColor: 'red', borderDash: [5, 5] }
          ]
        },
        options: {
          responsive: true,
          plugins: { title: { display: true, text: 'Қаржы өсімі (үздіксіз)' } },
          scales: { x: { title: { display: true, text: 'Уақыт (жыл)' } }, y: { title: { display: true, text: 'Сома' } } }
        }
      });
    }

    /* ---------------- CHEMISTRY ---------------- */
    function updateChemistry() {
      const k = parseFloat(document.getElementById('k-chem').value);
      const A0 = parseFloat(document.getElementById('A0-chem').value);
      const dt = parseFloat(document.getElementById('dt-chem').value);

      const tMax = 50;
      const timePoints = [];
      const analyticalA = [];
      const numericalA = [];
      let A = A0;

      for (let t = 0; t <= tMax + 1e-9; t += dt) {
        timePoints.push(t.toFixed(1));
        analyticalA.push(1 / (2 * k * t + 1 / A0));

        const dA = -2 * k * A * A;
        A += dA * dt;
        numericalA.push(A);
      }

      if (charts.chem) charts.chem.destroy();
      const ctx = document.getElementById('chemChart').getContext('2d');
      charts.chem = new Chart(ctx, {
        type: 'line',
        data: {
          labels: timePoints,
          datasets: [
            { label: 'Аналитикалық (қарапайым формула)', data: analyticalA, borderWidth: 2, borderColor: 'blue' },
            { label: 'Сандық (дифференциалдық)', data: numericalA, borderWidth: 2, borderColor: 'red', borderDash: [5, 5] }
          ]
        },
        options: {
          responsive: true,
          plugins: { title: { display: true, text: 'Екінші ретті реакция кинетикасы' } },
          scales: { x: { title: { display: true, text: 'Уақыт (с)' } }, y: { title: { display: true, text: 'Концентрация' } } }
        }
      });
    }

    /* ---------------- TEMPERATURE ---------------- */
    function updateTemperature() {
      const alpha = parseFloat(document.getElementById('alpha').value);
      const dx = parseFloat(document.getElementById('dx-temp').value);
      const dt = parseFloat(document.getElementById('dt-temp').value);

      const nx = 30;
      const Tb = 20;
      const impulse = 100 - Tb;
      const A = impulse * dx;
      const x0 = Math.floor(nx / 2) * dx;
      let T = new Array(nx).fill(Tb);
      T[Math.floor(nx / 2)] = 100;
      const timeSteps = 80;
      const t = timeSteps * dt;

      for (let n = 0; n < timeSteps; n++) {
        const Tn = T.slice();
        for (let i = 1; i < nx - 1; i++) {
          T[i] = Tn[i] + alpha * dt / (dx * dx) * (Tn[i + 1] - 2 * Tn[i] + Tn[i - 1]);
        }
      }

      const xPoints = [];
      const analyticalT = [];
      for (let i = 0; i < nx; i++) {
        const x = i * dx;
        xPoints.push(x.toFixed(2));
        if (t > 0) {
          analyticalT.push(Tb + A / Math.sqrt(4 * Math.PI * alpha * t) * Math.exp( -Math.pow(x - x0, 2) / (4 * alpha * t) ));
        } else {
          analyticalT.push(Tb);
        }
      }

      if (charts.temp) charts.temp.destroy();
      const ctx = document.getElementById('tempChart').getContext('2d');
      charts.temp = new Chart(ctx, {
        type: 'line',
        data: {
          labels: xPoints,
          datasets: [
            { label: 'Аналитикалық (қарапайым формула)', data: analyticalT, borderWidth: 2, borderColor: 'blue' },
            { label: 'Сандық (дифференциалдық)', data: T, borderWidth: 2, borderColor: 'red', borderDash: [5, 5] }
          ]
        },
        options: {
          responsive: true,
          plugins: { title: { display: true, text: 'Температура таралуы' } },
          scales: {
            x: { title: { display: true, text: 'x (м)' } },
            y: { title: { display: true, text: 'T (C)' } }
          }
        }
      });
    }

    /* ---------------- POLLUTION ---------------- */
    function updatePollution() {
      const D = parseFloat(document.getElementById('D').value);
      const v = parseFloat(document.getElementById('v').value);
      const dx = parseFloat(document.getElementById('dx-poll').value);
      const dt = parseFloat(document.getElementById('dt-poll').value);

      const nx = 30;
      const impulse = 10;
      const A = impulse * dx;
      const x0 = Math.floor(nx / 3) * dx;
      let C = new Array(nx).fill(0);
      C[Math.floor(nx / 3)] = impulse;
      const timeSteps = 100;
      const t = timeSteps * dt;

      for (let n = 0; n < timeSteps; n++) {
        const Cn = C.slice();
        for (let i = 1; i < nx - 1; i++) {
          const lap = (Cn[i + 1] - 2 * Cn[i] + Cn[i - 1]) / (dx * dx);
          const adv = (Cn[i] - Cn[i - 1]) / dx;
          C[i] = Cn[i] + dt * (D * lap - v * adv);
        }
      }

      const xPoints = [];
      const analyticalC = [];
      for (let i = 0; i < nx; i++) {
        const x = i * dx;
        xPoints.push(x.toFixed(2));
        if (t > 0) {
          analyticalC.push(A / Math.sqrt(4 * Math.PI * D * t) * Math.exp( -Math.pow(x - x0 - v * t, 2) / (4 * D * t) ));
        } else {
          analyticalC.push(0);
        }
      }

      if (charts.pollution) charts.pollution.destroy();
      const ctx = document.getElementById('pollutionChart').getContext('2d');
      charts.pollution = new Chart(ctx, {
        type: 'line',
        data: {
          labels: xPoints,
          datasets: [
            { label: 'Аналитикалық (қарапайым формула)', data: analyticalC, borderWidth: 2, borderColor: 'blue' },
            { label: 'Сандық (дифференциалдық)', data: C, borderWidth: 2, borderColor: 'red', borderDash: [5, 5] }
          ]
        },
        options: {
          responsive: true,
          plugins: { title: { display: true, text: 'Ластану концентрациясы' } },
          scales: {
            x: { title: { display: true, text: 'x (м)' } },
            y: { title: { display: true, text: 'C' } }
          }
        }
      });
    }

    // Initialize first visible tab charts on load
    window.addEventListener('load', () => {
      updatePhysics();
    });
  </script>
</body>
</html>
